#
# =========================================================
# MT7986 / Filogic 830 · Final Override Layer
# 作用：对前文配置进行最终裁决与依赖补齐
# 可直接追加到原有内核配置末尾
# =========================================================
#

# ---------------------------------------------------------
# CPU / 调度 · 最终确认
# ---------------------------------------------------------
# 确保 HZ=250 与 schedutil 不被 defconfig 回滚
#
CONFIG_HZ=250
CONFIG_HZ_250=y

CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_STAT=y
CONFIG_CPU_FREQ_GOV_SCHEDUTIL=y
CONFIG_CPU_FREQ_DEFAULT_GOV_SCHEDUTIL=y
# CONFIG_CPU_FREQ_GOV_PERFORMANCE is not set
# CONFIG_SCHED_AUTOGROUP is not set


# ---------------------------------------------------------
# 内存管理 · 最终确认
# ---------------------------------------------------------
# 路由器场景明确禁用 THP / Swap
#
# CONFIG_TRANSPARENT_HUGEPAGE is not set
# CONFIG_ARCH_WANTS_THP_SWAP is not set
# CONFIG_SWAP is not set


# ---------------------------------------------------------
# 网络数据路径 · 最终裁决
# ---------------------------------------------------------
# 保留 RPS / XPS（运行时调优）
#
CONFIG_RPS=y
CONFIG_XPS=y
# CONFIG_RFS_ACCEL is not set


# ---------------------------------------------------------
# Conntrack · 明确开启（为 AppFilter / 状态跟踪服务）
# ---------------------------------------------------------
CONFIG_NF_CONNTRACK=y
CONFIG_NF_CONNTRACK_EVENTS=y
CONFIG_NF_CONNTRACK_TIMESTAMP=y


# ---------------------------------------------------------
# Flow / HNAT · 裁决说明
# ---------------------------------------------------------
# 保留 NF_FLOW_TABLE + MTK HNAT
# （你当前选择的是“兼容优先”模式，而非极限单一路径）
#
CONFIG_NF_FLOW_TABLE=y
CONFIG_NET_MEDIATEK_HNAT=y


# ---------------------------------------------------------
# 加密加速 · ARMv8 CE 最终确认
# ---------------------------------------------------------
CONFIG_CRYPTO_AES_ARM64_CE=y
CONFIG_CRYPTO_SHA2_ARM64_CE=y
CONFIG_CRYPTO_GHASH_ARM64_CE=y
CONFIG_CRYPTO_SM4_ARM64_CE_GCM=y


# ---------------------------------------------------------
# BPF 子系统 · 控制面使用，非 XDP
# ---------------------------------------------------------
CONFIG_BPF=y
CONFIG_BPF_SYSCALL=y
CONFIG_BPF_JIT=y
CONFIG_BPF_EVENTS=y
# CONFIG_BPF_JIT_ALWAYS_ON is not set
# CONFIG_BPF_PRELOAD is not set
# CONFIG_DEBUG_INFO_BTF is not set


# ---------------------------------------------------------
# 调试 · 生产环境彻底关闭
# ---------------------------------------------------------
# CONFIG_DEBUG_KERNEL is not set
# CONFIG_DEBUG_INFO is not set
# CONFIG_DEBUG_MISC is not set
# CONFIG_DEBUG_FS is not set
# CONFIG_MAGIC_SYSRQ is not set
# CONFIG_PCI_DEBUG is not set
# CONFIG_SYSCTL_EXCEPTION_TRACE is not set
# CONFIG_KALLSYMS is not set
# CONFIG_KALLSYMS_ALL is not set
# CONFIG_COREDUMP is not set
# CONFIG_PRINTK_TIME is not set


# ---------------------------------------------------------
# 安全 · 保守且不牺牲性能
# ---------------------------------------------------------
CONFIG_STACKPROTECTOR_STRONG=y
CONFIG_RODATA_FULL_DEFAULT_ENABLED=y
CONFIG_SECURITY=y
CONFIG_SECURITY_NETWORK=y

# A53 风险极低，但你当前选择“安全优先”
CONFIG_CPU_MITIGATIONS=y


# ---------------------------------------------------------
# Netfilter / fw4 · 最终一致性确认
# ---------------------------------------------------------
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_NETFILTER_XTABLES=y

CONFIG_NF_TABLES=y
CONFIG_NF_TABLES_IPV4=y
CONFIG_NF_TABLES_IPV6=y

# IPv4 iptables（兼容 AppFilter）
CONFIG_IP_NF_IPTABLES=m
CONFIG_IP_NF_FILTER=m
CONFIG_IP_NF_NAT=m
CONFIG_NF_REJECT_IPV4=y


# ---------------------------------------------------------
# 内核抢占模型 · 吞吐量取向
# ---------------------------------------------------------
CONFIG_KERNEL_PREEMPT_VOLUNTARY=y
# CONFIG_KERNEL_PREEMPT is not set


# ---------------------------------------------------------
# Namespaces / Cgroups · 路由器裁剪
# ---------------------------------------------------------
# CONFIG_USER_NS is not set
# CONFIG_PID_NS is not set
# CONFIG_IPC_NS is not set

# CONFIG_CGROUP_DEVICE is not set
# CONFIG_CGROUP_PIDS is not set
# CONFIG_CGROUP_FREEZER is not set
# CONFIG_CGROUP_CPUACCT is not set
# CONFIG_NET_CLS_CGROUP is not set
# CONFIG_RT_GROUP_SCHED is not set


# ---------------------------------------------------------
# 其他不用的内核子系统
# ---------------------------------------------------------
# CONFIG_FANOTIFY is not set
# CONFIG_IP_MROUTE is not set
# CONFIG_IP_PIMSM_V1 is not set
# CONFIG_IP_PIMSM_V2 is not set
# CONFIG_IPV6_MROUTE is not set
# CONFIG_IPV6_PIMSM_V2 is not set
# CONFIG_IPV6_SEG6_LWTUNNEL is not set

#
# ===================== End of Final Override =====================
#
